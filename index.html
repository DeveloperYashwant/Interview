<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Interview Questions Manager</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
    <script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
    <style>
        body { transition: 0.3s; }
        .hidden { display: none; }
    </style>
</head>
<body class="bg-light">
    <div class="container mt-4">
        <h2 class="text-center">Interview Questions Bank</h2>

        <!-- Select Options -->
        <div class="row g-3">
            <div class="col-md-6">
                <select id="languageSelect" class="form-select">
                    <option value="">Select Technology</option>
                    <option value="c">C Programming</option>
                    <option value="cpp">C++</option>
                    <option value="python">Python</option>
                    <option value="webdev">Web Development</option>
                    <option value="mern">MERN Stack</option>
                    <option value="angular">Angular</option>
                    <option value="java">Java</option>
                    <option value="advjava">Advanced Java</option>
                    <option value="springboot">Spring Boot</option>
                    <option value="datascience">Data Science</option>
                    <option value="ml">Machine Learning</option>
                    <option value="cloud">Cloud Computing</option>
                    <option value="devops">DevOps</option>
                </select>
            </div>
            <div class="col-md-6">
                <select id="levelSelect" class="form-select">
                    <option value="">Select Difficulty</option>
                    <option value="beginner">Beginner</option>
                    <option value="intermediate">Intermediate</option>
                    <option value="expert">Expert</option>
                </select>
            </div>
        </div>

        <hr>

        <!-- Bulk Questions Input -->
        <textarea id="bulkQuestions" class="form-control" rows="4" placeholder='Enter JSON format: [{"question":"Q1", "answer":"A1"}, {"question":"Q2", "answer":"A2"}]'></textarea>
        <button id="addBulkBtn" class="btn btn-primary w-100 mt-2">âž• Add Questions</button>

        <hr>

        <!-- Display Questions -->
        <h5>Available Questions</h5>
        <ul id="questionsList" class="list-group"></ul>

        <hr>

        <!-- Download Buttons -->
        <button id="savePDF" class="btn btn-danger w-100">ðŸ“„ Download as PDF</button>
        <button id="clearData" class="btn btn-warning w-100 mt-2">ðŸ—‘ Clear All Questions</button>
    </div>

    <script>
document.addEventListener("DOMContentLoaded", async function () {
    const dbName = "QuestionsDB";
    const dbVersion = 1;
    let db;

    async function openDB() {
        return new Promise((resolve, reject) => {
            let request = indexedDB.open(dbName, dbVersion);
            request.onupgradeneeded = function (event) {
                db = event.target.result;
                if (!db.objectStoreNames.contains("questions")) {
                    db.createObjectStore("questions", { keyPath: "id", autoIncrement: true });
                }
            };
            request.onsuccess = function (event) {
                db = event.target.result;
                resolve(db);
            };
            request.onerror = function (event) {
                reject("Database error: " + event.target.errorCode);
            };
        });
    }

    async function saveQuestions(lang, level, questionsArray) {
        db = await openDB();
        let transaction = db.transaction("questions", "readwrite");
        let store = transaction.objectStore("questions");

        questionsArray.forEach(q => {
            store.add({ lang, level, question: q.question, answer: q.answer });
        });

        transaction.oncomplete = () => {
            console.log("Questions saved.");
            broadcastUpdate();
            displayQuestions();
        };
    }

    async function getQuestions(lang, level) {
        db = await openDB();
        return new Promise((resolve) => {
            let transaction = db.transaction("questions", "readonly");
            let store = transaction.objectStore("questions");
            let request = store.getAll();
            request.onsuccess = () => {
                resolve(request.result.filter(q => q.lang === lang && q.level === level));
            };
        });
    }

    async function displayQuestions() {
        const lang = document.getElementById("languageSelect").value;
        const level = document.getElementById("levelSelect").value;
        const list = document.getElementById("questionsList");
        list.innerHTML = "";

        if (!lang || !level) {
            list.innerHTML = "<li class='list-group-item'>Select a language & level to view questions.</li>";
            return;
        }

        const storedQuestions = await getQuestions(lang, level);

        storedQuestions.forEach((item, index) => {
            const li = document.createElement("li");
            li.classList.add("list-group-item");
            li.innerHTML = `<b>${index + 1}. ${item.question}</b><br> <i>Answer:</i> ${item.answer}`;
            list.appendChild(li);
        });
    }

    document.getElementById("addBulkBtn").addEventListener("click", async function () {
        const lang = document.getElementById("languageSelect").value;
        const level = document.getElementById("levelSelect").value;
        let inputData = document.getElementById("bulkQuestions").value.trim();

        if (!lang || !level || !inputData) {
            alert("Select language, level & enter valid JSON!");
            return;
        }

        try {
            let newQuestions = JSON.parse(inputData);
            if (!Array.isArray(newQuestions)) throw "Invalid format";

            await saveQuestions(lang, level, newQuestions);
            document.getElementById("bulkQuestions").value = "";
        } catch (e) {
            alert("Invalid JSON format!");
        }
    });

    document.getElementById("clearData").addEventListener("click", async function () {
        if (confirm("Are you sure? This will delete ALL saved questions!")) {
            db = await openDB();
            let transaction = db.transaction("questions", "readwrite");
            let store = transaction.objectStore("questions");
            store.clear();
            transaction.oncomplete = () => {
                console.log("All questions cleared.");
                broadcastUpdate();
                displayQuestions();
            };
        }
    });

    // Sync data across open tabs
    const channel = new BroadcastChannel("questionSync");
    function broadcastUpdate() {
        channel.postMessage("update");
    }
    channel.onmessage = () => {
        displayQuestions();
    };

    document.getElementById("languageSelect").addEventListener("change", displayQuestions);
    document.getElementById("levelSelect").addEventListener("change", displayQuestions);

    displayQuestions();
});

        document.addEventListener("contextmenu", (e) => e.preventDefault());
        document.addEventListener("keydown", (e) => {
            if (e.ctrlKey && (e.key === "u" || e.key === "U")) e.preventDefault();
        });
    </script>
</body>
</html>
